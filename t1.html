<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style:blank"/>
  <meta charset="utf-8">
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
  <title>Ncnu Bus</title>
  <style>
    html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px;
    }
    .hint{
      position: absolute; left:-3000px;  top:0px;
      padding:5% 0% 5% 0%;
      width: 100%;
      height:100%;
      box-sizing: border-box;
    }
    p{
      text-align: center;
    }
    .back{
      background-color: #000;
      margin: auto;
      text-align: center;
      border: solid 1px ;
      padding: 5px;
      width:50px;
    }
    .left{
      height:100%;
      width:200px;
      color:#fff;
      font-family:"微軟正黑體","Microsoft JhengHei","新細明體","PMingLiU","細明體","MingLiU","標楷體","DFKai-sb",serif;
      font-size:28px;
      position: absolute;
      right: 0px;
      top: 0px;
      cursor:default;
      overflow: hidden;
    }
    .icon{
      margin-bottom: 5px;
      border-radius: 10px;
      height:50px;
      width:200px;
      background-color: #444;
      background-repeat: no-repeat;
      padding: 7px 0px 0px 50px;
      box-sizing: border-box;
    }
    .left-list-active{
      background-color: #3b5998;
    }
    .gra{

    }
    .width{
      width: 200px;
    }
    .size{
      background-size: 50px 50px;
    }
    .toggle{
      background-image: url(5.png); background-repeat: no-repeat;
      position:absolute; left:0px; top:0px; 
      width:50px; height:50px;  
    }
    .info{
      font-family:"微軟正黑體","Microsoft JhengHei","新細明體","PMingLiU","細明體","MingLiU","標楷體","DFKai-sb",serif;
      font-size:20px; cursor:default;
      padding:2px 5px 2px 5px;
      width:276px;  height: 29px;
      background-color:#414239; color:#FFFFFF;
      box-sizing: border-box;
      position: absolute; right:0px;  bottom:0px;
    }
    a,a:link,a:visited{text-decoration: none;
    }
    @media screen and (max-width: 767px) {
      /*// 如果使用者之視窗寬度 <= 768px，將會再載入這裡的 CSS。    */
      .left{
        height:100%;
        width:150px;
        color:#fff;
        font-family :"微軟正黑體", "Microsoft JhengHei", "新細明體", "PMingLiU", "細明體", "MingLiU", "標楷體", "DFKai-sb", serif;
        font-size:21px;
        position: absolute;
        right: 0px;
        top: 0px;
        cursor:default;
        overflow: hidden;
      }
      .icon{
        height:37.5px;
        width:150px;
        background-color: #444;
        background-repeat: no-repeat;
        padding: 6px 0px 0px 37.5px;
        box-sizing: border-box;
      }
      .left-list-active{
        background-color: #3b5998;
      }
      .gra{
      }
      .width{
        width: 150px;
      }
      .size{
        background-size: 37.5px 37.5px;
      }
    }/*// 如果使用者之裝置寬度 <= 480px，將會再載入這裡的 CSS。 */
    @media screen and (max-width: 480px) {
      .info{
        font-family:"微軟正黑體","Microsoft JhengHei","新細明體","PMingLiU","細明體","MingLiU","標楷體","DFKai-sb",serif;
        font-size:20px; cursor:default;
        padding:2px 5px 2px 5px;
        width:100%;  height: 29px;
        background-color:#414239; color:#FFFFFF;
        box-sizing: border-box;
        text-align: center;
        position: absolute; right:0px;  bottom:0px;
      }
      .left{
        height:100%;
        width:110px;
        color:#fff;
        font-family :"微軟正黑體", "Microsoft JhengHei", "新細明體", "PMingLiU", "細明體", "MingLiU", "標楷體", "DFKai-sb", serif;
        font-size:14px;
        position: absolute;
        right: 0px;
        top: 0px;
        cursor:default;
        overflow: hidden;
      }
      .icon{
        margin-bottom: 5px;
        border-radius: 10px;
        height:30px;
        width:110px;
        background-color: #444;
        background-repeat: no-repeat;
        padding: 6px 0px 0px 35px;
        box-sizing: border-box;
      }
      .left-list-active{
        background-color: #3b5998;
      }
      .gra{
      }
      .width{
        width: 110px;
      }
      .size{
        background-size: 30px 30px;
      }
      .hint{
        position: absolute; left:-3000px;  top:0px;
        padding:5% 0% 5% 0%;
        width: 100%;
        height:100%;
        box-sizing: border-box;
      }
      p{
        text-align: center;
      }
      .back{
        background-color: #000;
        margin: auto;
        text-align: center;
        border: solid 1px ;
        padding: 5px;
        width:50px;
      }
      .list{
        height: 100%;
        width: 100%;
        position: absolute;
        left: 0px;
        top: 0px;
      }
      .list_in{

        text-align: center;
        background-color: #638998;
      }
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
  <script>
    var map,lat,lng,marker,stop=[],stopinfo=[],stopinfo2=[],correct=0,clk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var setime=0,avgspeed=10,rightnow,cp=1,zone,nearstop=1,getplace=0,people;
    var getpos,info,peopleinfo=0,leftbox=1;clk2=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var table1=[{come:new Date(2014,5,23,8,10),back:new Date(2014,5,23,7,30)},
        {come:new Date(2014,5,23,9,10),back:new Date(2014,5,23,8,35)},
        {come:new Date(2014,5,23,10,10),back:new Date(2014,5,23,9,35)},
        {come:new Date(2014,5,23,11,10),back:new Date(2014,5,23,10,35)},
        {come:new Date(2014,5,23,12,10),back:new Date(2014,5,23,11,35)},
        {come:new Date(2014,5,23,13,10),back:new Date(2014,5,23,12,10)},
        {come:new Date(2014,5,23,14,10),back:new Date(2014,5,23,12,35)},
        {come:new Date(2014,5,23,15,10),back:new Date(2014,5,23,13,35)},
        {come:new Date(2014,5,23,16,10),back:new Date(2014,5,23,14,35)},
        {come:new Date(2014,5,23,17,10),back:new Date(2014,5,23,15,35)},
        {come:new Date(2014,5,23,17,35),back:new Date(2014,5,23,16,35)},
        {come:new Date(2014,5,23,18,10),back:new Date(2014,5,23,17,10)},
        {come:new Date(2014,5,23,18,35),back:new Date(2014,5,23,17,35)},
        {come:new Date(2014,5,23,19,10),back:new Date(2014,5,23,18,10)},
        {come:new Date(2014,5,23,20,10),back:new Date(2014,5,23,18,35)},
        {come:new Date(2014,5,23,21,10),back:new Date(2014,5,23,19,10)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,19,35)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,20,10)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,20,35)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,21,10)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,21,35)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,22,35)}];
    var table2=[{come:new Date(2014,5,23,8,10),back:new Date(2014,5,23,7,40)},
        {come:new Date(2014,5,23,9,10),back:new Date(2014,5,23,8,35)},
        {come:new Date(2014,5,23,10,10),back:new Date(2014,5,23,9,35)},
        {come:new Date(2014,5,23,11,10),back:new Date(2014,5,23,10,35)},
        {come:new Date(2014,5,23,12,10),back:new Date(2014,5,23,11,35)},
        {come:new Date(2014,5,23,13,10),back:new Date(2014,5,23,12,10)},
        {come:new Date(2014,5,23,14,10),back:new Date(2014,5,23,12,35)},
        {come:new Date(2014,5,23,15,10),back:new Date(2014,5,23,13,35)},
        {come:new Date(2014,5,23,16,10),back:new Date(2014,5,23,14,35)},
        {come:new Date(2014,5,23,17,10),back:new Date(2014,5,23,15,35)},
        {come:new Date(2014,5,23,17,35),back:new Date(2014,5,23,16,35)},
        {come:new Date(2014,5,23,18,10),back:new Date(2014,5,23,17,35)},
        {come:new Date(2014,5,23,19,10),back:new Date(2014,5,23,18,35)},
        {come:new Date(2014,5,23,20,10),back:new Date(2014,5,23,19,35)},
        {come:new Date(2014,5,23,20,10),back:new Date(2014,5,23,20,10)},
        {come:new Date(2014,5,23,21,10),back:new Date(2014,5,23,20,35)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,21,35)},
        {come:new Date(2014,5,23,22,10),back:new Date(2014,5,23,22,35)}];

    // setInterval("fk()",1000);
    function fk(){
      if(new Date().getDay()==4){
        table1=[{come:new Date(2014,5,23,8,10),back:new Date(2014,5,23,7,40)}];
        cb();
      }
    }

    var t=[{time:0,duration:1285,lat:23.9511156593632,lng:120.93099094927311,title:"行政大樓"},
    {time:56,duration:1229,lat:23.95012473783793,lng:120.92660620808601,title:"小七前"},
    {time:107,duration:1178,lat:23.954282022375324,lng:120.92724993824959,title:"科技學院"},
    {time:265,duration:980,lat:23.94733393834808,lng:120.93442350625992,title:"教師宿舍"},
    {time:815,duration:430,lat:23.971017658649654,lng:120.94851449131966,title:"崎下"},
    {time:865,duration:380,lat:23.970071618819073,lng:120.95155075192451,title:"大成國小"},
    {time:915,duration:330,lat:23.969542225624178,lng:120.95432952046394,title:"OK"},
    {time:960,duration:285,lat:23.96877754272594,lng:120.9569688141346,title:"榮民醫院"},
    {time:1010,duration:235,lat:23.96820280210677,lng:120.95987230539322,title:"埔里酒廠"},
    {time:1050,duration:195,lat:23.967516541300366,lng:120.96233993768692,title:"郵局"},
    {time:1135,duration:-1,lat:23.96532048216488,lng:120.96249014139175,title:"媽祖廟"},
    {time:1185,duration:-1,lat:23.963477332226017,lng:120.96450716257095,title:"農會"},
    {time:1255,duration:-1,lat:23.960810600561476,lng:120.96744686365128,title:"今埔里大飯店"},
    {time:1365,duration:0,lat:23.96357537277995,lng:120.96914201974869,title:"南投客運總站"},
    {time:-1,duration:85,lat:23.965923421769574,lng:120.96656709909439,title:"台灣企銀"}];

    var line=[{lat:23.951110144048045,lng:120.93104794621468,time:0},
    {lat:23.950415825657323,lng:120.93096815049648,time:10},
    {lat:23.949609357588724,lng:120.92894308269024,time:21},
    {lat:23.94975643420817,lng:120.92688985168934,time:20},
    {lat:23.95012473783793,lng:120.92660620808601,time:5},
    {lat:23.954282022375324,lng:120.92724993824959,time:51},
    {lat:23.95463499319251,lng:120.9279365837574,time:8},   
    {lat:23.953948660160915,lng:120.93300059437752,time:71},
    {lat:23.952531861135988,lng:120.93460991978645,time:23},
    {lat:23.950943458949574,lng:120.93491032719612,time:18},
    {lat:23.948902774649444,lng:120.93463808298111,time:23},
    {lat:23.948589008915494,lng:120.93416601419449,time:5},
    {lat:23.94803991704473,lng:120.93453079462051,time:8},
    {lat:23.948432125762345,lng:120.9349599480629,time:7},
    {lat:23.948902774649444,lng:120.93463808298111,time:7},
    {lat:23.950943458949574,lng:120.93491032719612,time:23},
    {lat:23.950374766991704,lng:120.9360046684742,time:13},
    {lat:23.949531529473592,lng:120.93551114201546,time:17},
    {lat:23.946982173221034,lng:120.93529656529427,time:29},
    {lat:23.946668402815767,lng:120.93300059437752,time:24},
    {lat:23.94592319504479,lng:120.93334391713142,time:10},
    {lat:23.946452685219466,lng:120.93641236424446,time:32},
    {lat:23.94927659611551,lng:120.93727067112923,time:33},
    {lat:23.94949230898978,lng:120.93800023198128,time:8},
    {lat:23.950747358557734,lng:120.93877270817757,time:20},
    {lat:23.953845709890693,lng:120.93896582722664,time:38},
    {lat:23.956747895521936,lng:120.94293549656868,time:55},
    {lat:23.96085594527064,lng:120.94555333256721,time:55},
    {lat:23.964473665890203,lng:120.94658330082893,time:47},  
    {lat:23.966591308898934,lng:120.94623997807503,time:45},
    {lat:23.971100988249493,lng:120.94795659184456,time:80},
    {lat:23.967238359545426,lng:120.96355631947517,time:265},
    {lat:23.966973657400818,lng:120.9635777771473,time:10},
    {lat:23.96571876576225,lng:120.96222594380379,time:45},
    {lat:23.960483382909892,lng:120.96793368458748,time:135},
    {lat:23.962483441906173,lng:120.97016528248787,time:65},
    {lat:23.963503067884226,lng:120.96909239888191,time:45}];
    var line2=[{lat:23.963503067884226,lng:120.96909239888191,time:0},
    {lat:23.96685601182857,lng:120.96546605229378,time:120},
    {lat:23.967071695295353,lng:120.96409276127815,time:30},
    {lat:23.967306985938396,lng:120.96396401524544,time:10},
    {lat:23.967238359545426,lng:120.96355631947517,time:15},
    {lat:23.971100988249493,lng:120.94795659184456,time:265},
    {lat:23.966591308898934,lng:120.94623997807503,time:80},
    {lat:23.964473665890203,lng:120.94658330082893,time:45},
    {lat:23.96085594527064,lng:120.94555333256721,time:47},
    {lat:23.956747895521936,lng:120.94293549656868,time:55},
    {lat:23.953845709890693,lng:120.93896582722664,time:55},
    {lat:23.950747358557734,lng:120.93877270817757,time:38},
    {lat:23.94949230898978,lng:120.93800023198128,time:20},
    {lat:23.94927659611551,lng:120.93727067112923,time:8},
    {lat:23.946452685219466,lng:120.93641236424446,time:33},
    {lat:23.94592319504479,lng:120.93334391713142,time:32},
    {lat:23.946668402815767,lng:120.93300059437752,time:10},
    {lat:23.946982173221034,lng:120.93529656529427,time:24},  
    {lat:23.949531529473592,lng:120.93551114201546,time:29},  
    {lat:23.950374766991704,lng:120.9360046684742,time:17},  
    {lat:23.950943458949574,lng:120.93491032719612,time:13},  
    {lat:23.948902774649444,lng:120.93463808298111,time:23},  
    {lat:23.948589008915494,lng:120.93416601419449,time:5},    
    {lat:23.94803991704473,lng:120.93453079462051,time:8},    
    {lat:23.948432125762345,lng:120.9349599480629,time:7},    
    {lat:23.948902774649444,lng:120.93463808298111,time:7},   
    {lat:23.950943458949574,lng:120.93491032719612,time:23},
    {lat:23.952531861135988,lng:120.93460991978645,time:18},   
    {lat:23.953948660160915,lng:120.93300059437752,time:23},   
    {lat:23.95463499319251,lng:120.9279365837574,time:71},
    {lat:23.954282022375324,lng:120.92724993824959,time:8},
    {lat:23.95012473783793,lng:120.92660620808601,time:51},
    {lat:23.94975643420817,lng:120.92688985168934,time:5},
    {lat:23.949609357588724,lng:120.92894308269024,time:20},
    {lat:23.950415825657323,lng:120.93096815049648,time:21},
    {lat:23.950566578247624,lng:120.93153811991215,time:6},
    {lat:23.95100412745074,lng:120.93182645738125,time:11},
    {lat:23.951533596770673,lng:120.93163333833218,time:11},         
    {lat:23.951820391744793,lng:120.93119077384472,time:13},
    {lat:23.951110144048045,lng:120.93104794621468,time:12},
    {lat:23.950415825657323,lng:120.93096815049648,time:10}];
  var comepath = [new google.maps.LatLng(23.951094210917297,120.93104392290115),  //行政大樓
  new google.maps.LatLng(23.950415825657323,120.93096815049648),//60m
  new google.maps.LatLng(23.949609357588724,120.92894308269024),//224m
  new google.maps.LatLng(23.94975643420817,120.92688985168934),//209m
  new google.maps.LatLng(23.95012473783793,120.92660620808601),//50m
  new google.maps.LatLng(23.954282022375324,120.92724993824959),//467m
  new google.maps.LatLng(23.95463499319251,120.9279365837574),//80m
  new google.maps.LatLng(23.953948660160915,120.93300059437752),//520m
  new google.maps.LatLng(23.952531861135988,120.93460991978645),//227m
  new google.maps.LatLng(23.950943458949574,120.93491032719612),//179m  @
  new google.maps.LatLng(23.948902774649444,120.93463808298111),//229
  new google.maps.LatLng(23.948589008915494,120.93416601419449),//59
  new google.maps.LatLng(23.94803991704473,120.93453079462051),//71
  new google.maps.LatLng(23.948432125762345,120.9349599480629),//62
  new google.maps.LatLng(23.948902774649444,120.93463808298111),//62
  new google.maps.LatLng(23.950943458949574,120.93491032719612),//229
  new google.maps.LatLng(23.950374766991704,120.9360046684742),//128m   @
  new google.maps.LatLng(23.949531529473592,120.93551114201546),//168m
  new google.maps.LatLng(23.946982173221034,120.93529656529427),//284m
  new google.maps.LatLng(23.946668402815767,120.93300059437752),//236m
  new google.maps.LatLng(23.94592319504479,120.93334391713142),//90m
  new google.maps.LatLng(23.946452685219466,120.93641236424446),//317m
  new google.maps.LatLng(23.94927659611551,120.93727067112923),//326m
  new google.maps.LatLng(23.94949230898978,120.93800023198128),//78m
  new google.maps.LatLng(23.950747358557734,120.93877270817757),//160m
  new google.maps.LatLng(23.953845709890693,120.93896582722664),//345m 
  new google.maps.LatLng(23.956747895521936,120.94293549656868),//517m
  new google.maps.LatLng(23.96085594527064,120.94555333256721),//529m
  new google.maps.LatLng(23.964473665890203,120.94658330082893),//416m
  new google.maps.LatLng(23.966591308898934,120.94623997807503),//238m
  new google.maps.LatLng(23.971100988249493,120.94795659184456),//531m
  new google.maps.LatLng(23.967238359545426,120.96355631947517),//1642m
  new google.maps.LatLng(23.966973657400818,120.9635777771473),//29m  **
  new google.maps.LatLng(23.96571876576225,120.96222594380379),//196m
  new google.maps.LatLng(23.960483382909892,120.96793368458748),//822m
  new google.maps.LatLng(23.962483441906173,120.97016528248787),//318m
  new google.maps.LatLng(23.963503067884226,120.96909239888191)];//157m  總站
  var backpath=[new google.maps.LatLng(23.951094210917297,120.93104392290115),//行政大樓
  new google.maps.LatLng(23.951820391744793,120.93119077384472),//158m
  new google.maps.LatLng(23.951533596770673,120.93163333833218),//55m
  new google.maps.LatLng(23.95100412745074,120.93182645738125),//62m
  new google.maps.LatLng(23.950566578247624,120.93153811991215),//57m
  new google.maps.LatLng(23.950415825657323,120.93096815049648),//60m    @@@
  new google.maps.LatLng(23.949609357588724,120.92894308269024),//224m
  new google.maps.LatLng(23.94975643420817,120.92688985168934),//209m
  new google.maps.LatLng(23.95012473783793,120.92660620808601),//50m
  new google.maps.LatLng(23.954282022375324,120.92724993824959),//467m
  new google.maps.LatLng(23.95463499319251,120.9279365837574),//80m
  new google.maps.LatLng(23.953948660160915,120.93300059437752),//520m
  new google.maps.LatLng(23.952531861135988,120.93460991978645),//227m
  new google.maps.LatLng(23.950943458949574,120.93491032719612),//179m  
  new google.maps.LatLng(23.948902774649444,120.93463808298111),//229
  new google.maps.LatLng(23.948589008915494,120.93416601419449),//59
  new google.maps.LatLng(23.94803991704473,120.93453079462051),//71
  new google.maps.LatLng(23.948432125762345,120.9349599480629),//62
  new google.maps.LatLng(23.948902774649444,120.93463808298111),//62
  new google.maps.LatLng(23.950943458949574,120.93491032719612),//229
  new google.maps.LatLng(23.950374766991704,120.9360046684742),//128m
  new google.maps.LatLng(23.949531529473592,120.93551114201546),//168m
  new google.maps.LatLng(23.946982173221034,120.93529656529427),//284m
  new google.maps.LatLng(23.946668402815767,120.93300059437752),//236m
  new google.maps.LatLng(23.94592319504479,120.93334391713142),//90m
  new google.maps.LatLng(23.946452685219466,120.93641236424446),//317m
  new google.maps.LatLng(23.94927659611551,120.93727067112923),//326m
  new google.maps.LatLng(23.94949230898978,120.93800023198128),//78m
  new google.maps.LatLng(23.950747358557734,120.93877270817757),//160m
  new google.maps.LatLng(23.953845709890693,120.93896582722664),//345m 
  new google.maps.LatLng(23.956747895521936,120.94293549656868),//517m
  new google.maps.LatLng(23.96085594527064,120.94555333256721),//529m
  new google.maps.LatLng(23.964473665890203,120.94658330082893),//416m
  new google.maps.LatLng(23.966591308898934,120.94623997807503),//238m
  new google.maps.LatLng(23.971100988249493,120.94795659184456),//531m
  new google.maps.LatLng(23.967238359545426,120.96355631947517),//1642m 
  new google.maps.LatLng(23.967306985938396,120.96396401524544),//29m   
  new google.maps.LatLng(23.967071695295353,120.96409276127815),//142m  
  new google.maps.LatLng(23.96685601182857,120.96546605229378),//524m   
  new google.maps.LatLng(23.963503067884226,120.96909239888191)];//157m  總站];

  var come_Path = new google.maps.Polyline({
    path: comepath,
    geodesic: true,
    strokeColor: '#729CFE',
    strokeOpacity: 1.0,
    strokeWeight: 4
  });
  var back_Path = new google.maps.Polyline({
    path: backpath,
    geodesic: true,
    strokeColor: '#FF7598',
    strokeOpacity: 1.0,
    strokeWeight: 4
  });

  setTimeout("ifchange();settime();package();",500);
  setInterval("settime();",1000);
  setInterval("package();",10000);
  function package(){
    cb();
    // if(getplace==2){
    //   onbus();
     //  $.ajax({
     //    url: 'a.php',
     //    type: 'get',
     //    data: setime,
     //  })
     //  .done(function (data) {
     //   console.log(data);
     // });
// }
// else{
  if(cp==1){
    back_Path.setMap(null);
    come_Path.setMap(map);
  }
  else if(cp==0){ 
    come_Path.setMap(null);
    back_Path.setMap(map);
  }
  findplace();  car(); ifchange();
// }
}
  function getonbus(){//顯示現在位置 & 列出最近的車站
    if(window.navigator.geolocation){   
      var geolocation=window.navigator.geolocation;   
      geolocation.getCurrentPosition(getPositionSuccess);
      whichstop(getpos);
    }
  }
  function getPositionSuccess(position){   
    var initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);   
    map.setCenter(initialLocation);
    if(nearstop==0){
      people.setMap(map);
      people.setPosition(initialLocation);
    }
    getpos=initialLocation;
  }   
  function settime(){//增加判斷時間功能 
    var thistime = new Date().getHours()*60+ new Date().getMinutes();
    var temp=0;
    // console.log(setime+"setime");
    var thday=new Date().getDay();
    var today=thday+1;
    var tb1,tb2;//tb1昨天 tb2今天
    if(today==7) today=0;
    if(thday>0 && thday<6 && today>0 && today<6){
      tb1=table1; tb2=table1;
    }
    else if(thday==6 && today==0){
      tb1=table2; tb2=table2;
    }
    else if(thday==5 && today==6){
      tb1=table1; tb2=table2;
    }
    else if(thday==0 && today==1){
      tb1=table2; tb2=table1;
    }
    for(var x=0;x<tb1.length;x++)
    {
      if(cp==1){
        if(tb1[x].come.getHours()*60+tb1[x].come.getMinutes() > thistime){
          var zonetime1=(x>0)?tb1[x].come:tb2[0].come.setFullYear(2014, 5, 24);
          var zonetime2=(x>0)?tb1[x-1].come:tb1[tb1.length-1].come;
          zone=(zonetime1 - zonetime2)/1000;
          tb2[0].come.setFullYear(2014, 5, 23);
          // console.log(zone+"zone1");
          temp=1;
          break;
        }        
      }
      else{
        if(tb1[x].back.getHours()*60+tb1[x].back.getMinutes() > thistime){
          var zonetime1=(x>0)?tb1[x].back:tb2[0].back.setFullYear(2014, 5, 24);
          var zonetime2=(x>0)?tb1[x-1].back:tb1[tb1.length-1].back;         
          zone=(zonetime1 - zonetime2)/1000;
          tb2[0].back.setFullYear(2014, 5, 23);
          // console.log(zone+"zone2");
          temp=1;
          break;
        }
      }
    } 
    if(!temp){
      var j=(thday!=6 || thday!=0)?new Date(2014,5,24,6,55):new Date(2014,5,24,8,10);
      var k=(cp==1)?tb1[tb1.length-1].come:tb1[tb1.length-1].back;
      // console.log(j+"=j"+k+"=k");
      zone=(j - k)/1000;
      // console.log(zone+"zone3");
    }
    if(setime>=zone)
      setime=0;
    else
      setime+=1;
  }

  function car(){
    if(correct!=1){
      findplace();
      marker= new google.maps.Marker({ 
        position: new google.maps.LatLng(lat,lng),  
        map: map,
        icon:"img.jpg",
        zIndex:1                     
      });  
      correct=1;
    }
    else{
      marker.setPosition(new google.maps.LatLng(lat,lng));
    }
  }
  function allzero(){
    clk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  }
  function tomark(){
    for(var i=0;i<t.length;i++){
      var rule1=(cp==1)?(t[i].time-setime):(t[i].duration-setime);
      var rule2=(cp==1)?(zone-setime+t[i].time):(zone-setime+t[i].duration+10);
      var rule3=(cp==1)?t[i].time:t[i].duration;
      if(rule3-setime > 0){
        stopinfo[i].content='<div style="overflow:hidden;min-width:110px;">'+t[i].title+"<br>預估"+clock(rule1).toString()+"之後到站</div>";  
        stopinfo2[i]="<div style=\"overflow:hidden;min-width:110px;\">'預估"+clock(rule1).toString()+"之後到站</div>";
        // console.log(rule1+":"+setime+"r1");
      }
      else{
        stopinfo[i].content="<div style=\"overflow:hidden;min-width:110px;\">"+t[i].title+"<br>預估"+clock(rule2).toString()+"之後到站</div>";
        stopinfo2[i]="<div style=\"overflow:hidden;min-width:110px;\">預估"+clock(rule2).toString()+"之後到站</div>";
        // console.log(rule2+":"+setime+"r2");
      }
      if(cp==0 && setime>1285 || cp==1 && setime>1365){
        stopinfo[i].content="<div style=\"overflow:hidden;min-width:110px;\">"+t[i].title+"<br>預估"+clock(zone-setime+rule3).toString()+"之後到站</div>";
        stopinfo2[i]="<div style=\"overflow:hidden;min-width:110px;\">'預估"+clock(zone-setime+rule3).toString()+"之後到站</div>";
      } 
      if(rule3==-1)   stopinfo[i].content="未到站"; 
      if(clk2[i]==1){
        for(var j=0;j<t.length;j++)
        {
          stop[j].setIcon("1.png");
          stopinfo[j].close();
          clk2[j]=0;
        }
        
        stop[i].setIcon("2.png");
      }
      if(clk[i]==1) {
        for(var j=0;j<t.length;j++)
        {
          stop[j].setIcon("1.png");
          stopinfo[j].close();
        }
        stopinfo[i].open(map,stop[i]);
        stop[i].setIcon("2.png");
        // console.log(clk[i]+":"+i);
      }
      else if(clk[i]==2) {
        stopinfo[i].close();
        stop[i].setIcon("1.png");
        clk[i]=0;
        // console.log(clk[i]+":"+i);
      }
    }
  }
  //renew 公車位置
  function findplace(){//全程時間time  記時時間setime  現在時間t 剩餘時間rest
    var time=setime;
    var rest=time;
    var t=-1;
    var whichline=(cp==1)?line:line2;
    if(cp==0 && setime>1285){
      lat=23.963503067884226;
      lng=120.96909239888191;
    }
    else if(cp==1 && setime>1365){
      lat=23.951094210917297;
      lng=120.93104392290115;
    }
    else{
      for(var i=1;time>t;i++){
        // console.log("166 : "+time);
        if(t+whichline[i].time<=time){//大於某一區間內
          t+=whichline[i].time;
          rest-=whichline[i].time;
          lat=whichline[i].lat;
          lng=whichline[i].lng;
        }
        else{//小於某一區間
          lat=whichline[i-1].lat+(whichline[i].lat-whichline[i-1].lat)/whichline[i].time*rest;
          lng=whichline[i-1].lng+(whichline[i].lng-whichline[i-1].lng)/whichline[i].time*rest;
          t=time;
        }
        // }
      }
    }
    rightnow=t;
    // console.log(rightnow+":rightnow");
  }
  function ifchange(){
    var zoneinis;
    var e=(new Date().getDay() !==6 && new Date().getDay() !==0)?table1:table2;
    if(cp==1){
      for(var x=0;x<e.length;x++)
      {   
        if(e[x].come - new Date().setFullYear(2014, 5, 23) > 0){
          if(x>0){
            zoneinis=e[x-1].come;
            setime=parseInt((new Date().setFullYear(2014, 5, 23) - zoneinis)/1000);
          } 
          else{
            zoneinis=e[e.length-1].come;
            setime=parseInt((new Date().setFullYear(2014, 5, 24) - zoneinis)/1000);
            // console.log('1am');
          }
          break;
        } 
      }
      // console.log(zoneinis+"zoneinis");
      if(!zoneinis){
        setime=parseInt((new Date().setFullYear(2014, 5, 23)-e[e.length-1].come)/1000);
      }
    }
    else{
     for(var x=0;x<e.length;x++)
     {   
      if(e[x].back - new Date().setFullYear(2014, 5, 23) > 0){
        if(x>0){
          zoneinis=e[x-1].back;
          setime=parseInt((new Date().setFullYear(2014, 5, 23) - zoneinis)/1000);
        } 
        else{
          zoneinis=e[e.length-1].back;
          setime=parseInt((new Date().setFullYear(2014, 5, 24) - zoneinis)/1000);
          // console.log('1am');
        }
        break;
      } 
    }
    // console.log(zoneinis+"zoneinis");
    if(!zoneinis){
      setime=parseInt((new Date().setFullYear(2014, 5, 23)-e[e.length-1].back)/1000);
    }
  }
}
function distHaversine(p1, p2) {
  var rad = function (x) { return x * Math.PI / 180; }
  var R = 6371; // earth's mean radius in km
  var dLat = rad(p2.lat() - p1.lat());
  var dLong = rad(p2.lng() - p1.lng());
  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +Math.cos(rad(p1.lat())) * Math.cos(rad(p2.lat()))*
  Math.sin(dLong / 2) * Math.sin(dLong / 2);
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  var d = R * c;
  return parseFloat(d.toFixed(3));
}
function whichstop(e){
  // console.log(t.length);
  var x;
  for(var i=0;i<t.length;i++)
  {
    var a=(cp==1)?t[i].time:t[i].duration;
    if(a!=-1){
      y=distHaversine(e,new google.maps.LatLng(t[i].lat,t[i].lng));
      if(!x || y<x)  {x=y;wh=i;}
    }
  }
  if(nearstop==1) {
    map.setCenter(new google.maps.LatLng(t[wh].lat,t[wh].lng));
    for(var i=0;i<t.length;i++){ if(i==wh) {clk2[i]=1; clk[i]=1}else clk2[i]=0;} tomark();
  }
if(cp==1 && getplace==2 && nearstop==0){
  info.content="<a>暨大到埔里<br>最近車站:<a href='javascript:void(0)' onclick='nearstop=1; ifchange(); tomark(); getonbus();'>"+t[wh].title+"</a><br>"+stopinfo2[wh];
  info.open(map,people);
}
else if(cp==0 && getplace==2 && nearstop==0){
  info.content="<a>埔里到暨大<br>最近車站:<a href='javascript:void(0)' onclick='nearstop=1; ifchange(); tomark(); getonbus();'>"+t[wh].title+"</a><br>"+stopinfo2[wh];
  info.open(map,people);
}
}
function onbus(){
  if(navigator.geolocation) {
    var option={
      enableAcuracy:false,
      maximumAge:0,
      timeout:500
    };
    navigator.geolocation.getCurrentPosition(function(position) {
      var inline=0;
      var polat=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
      for(var x=0;x<line.length;x++)
      {
        var y=distHaversine(polat,new google.maps.LatLng(line[x].lat,line[x].lng));
        if(y*1000<=100){
          inline=1;
          break;
        }
        else if(x>0){
          if(Math.abs(line[x].lat-position.coords.latitude)+Math.abs(line[x-1].lat-position.coords.latitude)==
            Math.abs(line[x].lat-line[x-1].lat) && Math.abs(line[x].lng-position.coords.longitude)+
            Math.abs(line[x-1].lng-position.coords.longitude)==Math.abs(line[x].lng-line[x-1].lng)){
            inline=1;
          break;
        }
      }
    }
    if(inline==1){
        // console.log('1');
        marker.setPosition(polat);
      }
    });
  }
}

function clock(e){//詳細時間
  var a=new Date().getTime();
  if(new Date(a+e*1000).getHours()<10 && new Date(a+e*1000).getMinutes()<10){
    return "0"+new Date(a+e*1000).getHours()+":0"+new Date(a+e*1000).getMinutes();
  }
  else if(new Date(a+e*1000).getHours()<10 && new Date(a+e*1000).getMinutes()>10){
    return "0"+new Date(a+e*1000).getHours()+":"+new Date(a+e*1000).getMinutes();
  }
  else if(new Date(a+e*1000).getHours()>10 && new Date(a+e*1000).getMinutes()<10){
    return new Date(a+e*1000).getHours()+":0"+new Date(a+e*1000).getMinutes();
  }
  else
    return new Date(a+e*1000).getHours()+":"+new Date(a+e*1000).getMinutes();
}
  function cb(){//判斷星期幾
    var e=(new Date().getDay() !==6 && new Date().getDay() !==0)?table1:table2;
    var a,b,c,d;
    for(var x=0;x<e.length;x++)
    {   
      if(e[x].come - new Date().setFullYear(2014, 5, 23) > 0){
        a=e[x].come.getHours();
        b=e[x].come.getMinutes();
        break;
      }
    }
    // console.log("g1");
    for(var x=0;x<e.length;x++)
    {   
      if(e[x].back - new Date().setFullYear(2014, 5, 23) > 0){
        c=e[x].back.getHours();
        d=e[x].back.getMinutes();
        break;
      }
    }
    // console.log("g2");
    if(new Date().getDay()==5 || new Date().getDay()==6 ){
      if(!a){
        a=table2[0].come.getHours();
        b=table2[0].come.getMinutes();
      }
      if(!c){
        c=table2[0].back.getHours();
        d=table2[0].back.getMinutes();
      }
    }
    else{
     if(!a){
      a=table1[0].come.getHours();
      b=table1[0].come.getMinutes();
    }
    if(!c){
      c=table1[0].back.getHours();
      d=table1[0].back.getMinutes();
    }
  }
  var zn=(a<12)?"AM":"PM";
  var zn2=(c<12)?"AM":"PM";
  if(cp==1){
    document.getElementById("infobox").innerHTML="<b>暨大發車時間: "+a+":"+b+zn+"</b>";
  }
  else{
    document.getElementById("infobox").innerHTML="<b>埔里發車時間: "+c+":"+d+zn2+"</b>";
  }
}
function controlboxes(e){
  e.style.fontFamily = 'Arial,sans-serif';
  e.style.backgroundColor='#6B9EFE';
  e.style.cursor = 'pointer';
  e.style.fontSize = '12px';
  e.style.padding='2px 5px 2px 5px';
  e.style.margin = '5px 0 0 5px';
  e.style.color = '#fff';
}
function initialize() {


  ifchange(); 
  var mapOptions = {
    zoom: 15,
    center: new google.maps.LatLng(23.959748672077595,120.9504497051239),
    panControl: false,
    zoomControl: false,
    streetViewControl: false,
    mapTypeControl: false
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);
  people= new google.maps.Marker({ 
    position:new google.maps.LatLng(23,121),  
    map: map,
    icon:"img2.png",
    zIndex:2                   
  }); 
  google.maps.event.addListener(people,'click',function(){
    getplace=2;  findplace();tomark();  car(); ifchange(); getonbus();
  });
  people.setMap(null);
  if(peopleinfo==0){
    info = new google.maps.InfoWindow({content:"暨大到埔里<br>最近車站:"}); 
    propleinfo=1;
  } 
  for(var i=0;i<t.length;i++)
  {
    stop[i]=new google.maps.Marker({ 
      position: new google.maps.LatLng(t[i].lat,t[i].lng),  
      title:t[i].title,  
      map: map,
      icon:"1.png",
      zIndex:2                    
    });  
  }

stopinfo[0]=new google.maps.InfoWindow({content:(t[0].time/1000).toString()+'秒'}); //package(); 用事件驅動
google.maps.event.addListener(stop[0],'click',function(){if(clk[0]==0)allzero();clk[0]++;settime();ifchange();tomark();});
stopinfo[1]=new google.maps.InfoWindow({content:(t[1].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[1],'click',function(){if(clk[1]==0)allzero();clk[1]++;settime();ifchange();tomark();});
stopinfo[2]=new google.maps.InfoWindow({content:(t[2].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[2],'click',function(){if(clk[2]==0)allzero();clk[2]++;settime();ifchange();tomark();});
stopinfo[3]=new google.maps.InfoWindow({content:(t[3].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[3],'click',function(){if(clk[3]==0)allzero();clk[3]++;settime();ifchange();tomark();});
stopinfo[4]=new google.maps.InfoWindow({content:(t[4].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[4],'click',function(){if(clk[4]==0)allzero();clk[4]++;settime();ifchange();tomark();});
stopinfo[5]=new google.maps.InfoWindow({content:(t[5].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[5],'click',function(){if(clk[5]==0)allzero();clk[5]++;settime();ifchange();tomark();});
stopinfo[6]=new google.maps.InfoWindow({content:(t[6].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[6],'click',function(){if(clk[6]==0)allzero();clk[6]++;settime();ifchange();tomark();});
stopinfo[7]=new google.maps.InfoWindow({content:(t[7].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[7],'click',function(){if(clk[7]==0)allzero();clk[7]++;settime();ifchange();tomark();});
stopinfo[8]=new google.maps.InfoWindow({content:(t[8].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[8],'click',function(){if(clk[8]==0)allzero();clk[8]++;settime();ifchange();tomark();});
stopinfo[9]=new google.maps.InfoWindow({content:(t[9].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[9],'click',function(){if(clk[9]==0)allzero();clk[9]++;settime();ifchange();tomark();});
stopinfo[10]=new google.maps.InfoWindow({content:(t[10].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[10],'click',function(){if(clk[10]==0)allzero();clk[10]++;settime();ifchange();tomark();});
stopinfo[11]=new google.maps.InfoWindow({content:(t[11].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[11],'click',function(){if(clk[11]==0)allzero();clk[11]++;settime();ifchange();tomark();});
stopinfo[12]=new google.maps.InfoWindow({content:(t[12].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[12],'click',function(){if(clk[12]==0)allzero();clk[12]++;settime();ifchange();tomark();});
stopinfo[13]=new google.maps.InfoWindow({content:(t[13].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[13],'click',function(){if(clk[13]==0)allzero();clk[13]++;settime();ifchange();tomark();});
stopinfo[14]=new google.maps.InfoWindow({content:(t[14].time/1000).toString()+'秒',maxWidth: 110}); 
google.maps.event.addListener(stop[14],'click',function(){if(clk[14]==0)allzero();clk[14]++;settime();ifchange();tomark();});

cb();

var rightplace=document.createElement('div');
controlboxes(rightplace);
rightplace.style.margin="0px";
rightplace.style.padding="0px";  
rightplace.style.width="37px";
rightplace.style.height="37px";
rightplace.style.background="url('img8.png')";
rightplace.title="顯示我的位置";

google.maps.event.addDomListener(rightplace,'click',function(){
  getplace=2; nearstop=0; findplace();tomark();  car(); ifchange(); getonbus();
});

map.controls[google.maps.ControlPosition.TOP_RIGHT].push(rightplace);
}
google.maps.event.addDomListener(window, 'load', initialize);

function come_or_back(){

}

function t1(){
  $('.left').css('left', '0px');
}
function t2(){
  var a=$('#left1').css('width');
  $('.left').css('left', '-apx');
}
$(function(){
  window.onload = function(){
    setTimeout(function(){
      window.scrollTo(0, 1);
    }, 100);
  }
  setInterval("$('.list_in').css('height', '100%').css('height', '-=29px');",100);
  
  $('#infobox').click(function(event) {
    console.log('gg');
    $('.list').css('left', '0px');
    $('#infobox_out').css('left','0px');
    $('.list_in').empty();
    for(var i=0;i<9;i++)
    {
      var box=$('<div>').addClass('box').css('height','30px');
      box.text(table2[i].come);
      $('.list_in').append(box);
    }
  });
  $('#infobox_out').click(function(event) {
    $('.list_in').empty();
    $('.list').css('left', '-3000px');
    $('#infobox_out').css('left', '-3000px');
    console.log('GG');
  });
  $('#left2').addClass('left-list-active');
  $('#left8').click(function(event) {
    $('.hint').css('left', '0px');
  });
  $('.gra').on('click', function(event) {
    $('.gra').removeClass('left-list-active');
    var th = $(this);
    th.addClass('left-list-active');
  }); 
  $('#left2').click(function(event) {
    cp=1; back_Path.setMap(null);come_Path.setMap(map);
    cb();settime();ifchange(); tomark();findplace();car();
    if (getplace==2){ tomark(); getonbus();}
  });
  $('#left3').click(function(event) {
    cp=0; come_Path.setMap(null);back_Path.setMap(map);
    cb();settime();ifchange(); tomark();findplace();car();
    if (getplace==2){ tomark(); getonbus();}
  });
  $('#left5').click(function(event) {
    getplace=2; nearstop=0; findplace();tomark();  car(); ifchange(); getonbus();
  });
  $('#left6').click(function(event) {
    getplace=2;nearstop=1; allzero(); ifchange();tomark(); getonbus();
  });
});
</script>
</head>
<body>

<div id="map-canvas"></div>
<div class="left">
<div id="left2"class="icon gra size" style="background-image: url(7.png);">暨大到埔里</div>
<div id="left3"class="icon gra size" style="background-image: url(6.png);">埔里到暨大</div>
<div id="left5"class="icon gra size" style="background-image: url(8.png);">我在哪裡?</div>
<div id="left6"class="icon gra size" style="background-image: url(9.png);">最近車站</div>

  <a href="http://www.csie.ncnu.edu.tw/Default.aspx?CID=1138" target="_blank"><div id="left7"class="icon "
   style=" color:#fff; background-image: url(10.png);">WKE  LAB</div></a>
 </div>
 <div id="infobox" class="info" ></div>
 <div id="infobox_out" class="info" style="position: absolute; left: -3000px; text-align: center; z-index: 5;">Back</div>
 <div class="list" style="position: absolute; left: -3000px; top:0px; ">
   <div class="list_in"></div>
 </div>
</body>
</html>